---
title: "Project 3"
author: "Chuwen Liu"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(car)
library(corrplot)
setwd("~/GitHub/bios611-projects-fall-2019-lcw68/project_3/scripts")
client.entry = read_tsv("client_total.tsv")
client.entry = client.entry%>%select(-X1)
```

## Introduction to the dataset and things we want to explore

Urban Ministries of Durham provides various datasets for us to explore the different aspects of the client who once entered the shelter provided by UMD seeking for help, and based on the large amount data, we will be able to make some analysis for UMD to master the description and characteristics precisely, and make a better preparation for the future client.

We will show the wrangling process in python and make some plots in R. The variables we will use mainly contain: 
* Demographic statistics, including the race, age, ethinicity, gender...
* Time statistics, including the date who enter the shelter, the date who exit the shelter, the start and end date for income, health insurance...
* Categorical statistics for living condition, such as the health insurance coverage, living status, monthly income source, disability type.

We want to use some kind of variables to construct the correlation with staying time at the shelter. Also, we will see if there's some variables highly correlated, and consider the comparison between entry and exit to see if clients got enough help in shelters. Based on these two analysis, we will also conduct some other interesting analysis work.

### The distribution plot for the staying time

First I would like to explain the variables here: "Disability count" means that the total amount of disability the client has; "healins" has the similar meaning as for health insurance. And the "income_month" add all the income source of the client.
```{r Time}
p1 = client.entry %>%drop_na("Time Difference")%>%group_by(`Client ID`)%>%
  summarise(td = mean(`Time Difference`),age = min(Entry_age), visit = mean(Visit_time))%>%arrange(age)%>%mutate(index = 1:2311)
ggplot(p1,aes(x=index,y=td))+geom_bar(size = 1.5,alpha = 1,stat="identity")+
  labs(x = "Client Sorted by the year of first time entry",y= "Average Time Difference",title ="Distribution of Staying time")+ylim(c(0,500))

ggplot(p1,aes(x= td, fill =age))+geom_histogram(bins = 80)+xlim(c(0,500))+labs(x="Time Length",title="Distribution of Staying Time at shelter")+theme_bw()

ggplot(p1,aes(x= visit))+geom_histogram(bins = 30)+labs(x="Visit times",title="Distribution of Visit times at shelter")+theme_bw()

```

## Distribution of the different potential independent variables

We will explore the other important variables' distribution and correlation among them.
```{r income}
#Group by two main gender

client.entry%>%drop_na(income_month)%>%filter(`Client Gender` %in% c("Female","Male"))%>%ggplot(aes(x=income_month,fill = `Client Gender`))+geom_histogram(bins = 30,position = "dodge")+labs(x = "income",y = "Frequency",title = "Income Distribution")

# Group by two main race
client.entry%>%filter(race %in% c("Black or African American (HUD)","White (HUD)"),`Client Gender` %in% c("Female","Male"))%>%drop_na(income_month)%>% ggplot(aes(x=income_month,fill = race))+geom_histogram(bins = 20,position = "dodge")+theme_bw()+labs(x = "income",y = "Frequency",title = "Income Distribution")

#Group by two main ethnicity
client.entry%>%filter(`Client Ethnicity` %in% c("Non-Hispanic/Non-Latino (HUD)","Hispanic/Latino (HUD)"))%>%drop_na(income_month)%>%
  ggplot(aes(x=income_month,fill = `Client Ethnicity`))+geom_histogram(bins = 20,position = "dodge")+theme_bw()+labs(x = "income",y = "Frequency",title = "Income Distribution")

#Distribution of Client's health insurance amount
client.entry%>%drop_na(healins)%>%filter(healins < 50)%>%ggplot(aes(x =healins,fill = `Client Gender`))+geom_histogram(bins = 20,position = "dodge")+theme_bw()+labs(x = "health insurance",y = "Frequency",title = "Insurance Distribution")


```

## Correlation among variables

```{r health}

client.entry%>%drop_na(healins)%>%filter(healins < 50)%>%ggplot(aes(x =Entry_age,y = healins))+geom_point()+geom_smooth()+theme_bw()+labs(x="Age",y = "insurance",title = "correlation between age and insurance")

client.entry%>%ggplot(aes(x =Entry_age,y = income_month))+geom_bar(stat = "identity")+theme_bw()+labs(x="monthly income",title = "correlation between age and income")

client.entry%>%drop_na(healins,income_month)%>%filter(healins < 50)%>%ggplot(aes(x =income_month,y = healins))+geom_point()+geom_smooth()+theme_bw()+labs(x="Income",y = "insurance",title = "correlation between Income and insurance")

client.entry%>%filter(income_month < 25000)%>%drop_na(`Disability count`,income_month)%>%ggplot(aes(x =income_month,y = `Disability count`))+geom_point()+geom_smooth()+theme_bw()+labs(x="Income",y = "Disability count",title = "correlation between Disability count and Income")

cor.test(client.entry$`Time Difference`,client.entry$income_month)
cor.test(client.entry$`Time Difference`,client.entry$healins)
cor.test(client.entry$`Time Difference`,client.entry$`Disability count`)
cor.test(client.entry$`Time Difference`,client.entry$Entry_age)
cordat = as.data.frame(client.entry%>%select(`Time Difference`,income_month,healins,Entry_age,`Disability count`)%>%drop_na(`Time Difference`,income_month,healins,Entry_age,`Disability count`))
A = cor(cordat) 
corrplot(A)

```
After conducting the correlation test and the correlation plot, we found that the time difference has little correlation with these continuous variable, but it actually shows the trend.



